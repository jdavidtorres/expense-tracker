<div class="card" *ngIf="isVisible">
  <div class="card-header bg-primary text-white">
    <h5 class="mb-0">
      <i-lucide [name]="isEdit ? 'edit-2' : 'plus'" class="me-2"></i-lucide>
      {{ isEdit ? 'Edit' : 'Add New' }} Subscription
    </h5>
  </div>

  <div class="card-body">
    <form (ngSubmit)="onSubmit()" #subscriptionForm="ngForm">
      <div class="alert alert-danger" *ngIf="error">
        <i-lucide name="alert-circle" class="me-2"></i-lucide>
        {{ error }}
      </div>

      <div class="row g-3">
        <div class="col-md-6">
          <label for="name" class="form-label">Subscription Name *</label>
          <input
            type="text"
            class="form-control"
            id="name"
            name="name"
            [(ngModel)]="model.name"
            required
            #name="ngModel">
          <div class="invalid-feedback" [class.d-block]="name.invalid && (name.dirty || name.touched)">
            Please provide a name for the subscription.
          </div>
        </div>

        <div class="col-md-6">
          <label for="category" class="form-label">Category *</label>
          <select
            class="form-select"
            id="category"
            name="category"
            [(ngModel)]="model.category"
            required>
            <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
          </select>
        </div>

        <div class="col-md-6">
          <label for="amount" class="form-label">Amount *</label>
          <div class="input-group">
            <span class="input-group-text">$</span>
            <input
              type="number"
              class="form-control"
              id="amount"
              name="amount"
              [(ngModel)]="model.amount"
              step="0.01"
              min="0"
              required
              #amount="ngModel">
          </div>
          <div class="invalid-feedback" [class.d-block]="amount.invalid && (amount.dirty || amount.touched)">
            Please provide a valid amount.
          </div>
        </div>

        <div class="col-md-6">
          <label for="billingCycle" class="form-label">Billing Cycle *</label>
          <select
            class="form-select"
            id="billingCycle"
            name="billingCycle"
            [(ngModel)]="model.billingCycle"
            required>
            <option *ngFor="let cycle of billingCycles" [value]="cycle.value">{{ cycle.label }}</option>
          </select>
        </div>

        <div class="col-md-6">
          <label for="startDate" class="form-label">Start Date *</label>
          <input
            type="date"
            class="form-control"
            id="startDate"
            name="startDate"
            [ngModel]="model.startDate | date: 'yyyy-MM-dd'"
            (ngModelChange)="model.startDate = $event"
            required
            #startDate="ngModel">
        </div>

        <div class="col-md-6">
          <label for="paymentDate" class="form-label">Next Payment Date *</label>
          <input
            type="date"
            class="form-control"
            id="paymentDate"
            name="paymentDate"
            [ngModel]="model.paymentDate | date: 'yyyy-MM-dd'"
            (ngModelChange)="model.paymentDate = $event"
            required
            #paymentDate="ngModel">
        </div>

        <div class="col-md-6">
          <label for="frequency" class="form-label">Frequency *</label>
          <select
            class="form-select"
            id="frequency"
            name="frequency"
            [(ngModel)]="model.frequency"
            required>
            <option *ngFor="let freq of frequencies" [value]="freq.value">{{ freq.label }}</option>
          </select>
        </div>

        <div class="col-md-6">
          <label class="form-label">Status</label>
          <div class="form-check form-switch">
            <input
              class="form-check-input"
              type="checkbox"
              id="isActive"
              name="isActive"
              [(ngModel)]="model.isActive">
            <label class="form-check-label" for="isActive">
              {{ model.isActive ? 'Active' : 'Inactive' }}
            </label>
          </div>
        </div>

        <div class="col-12">
          <label for="notes" class="form-label">Notes</label>
          <textarea
            class="form-control"
            id="notes"
            name="notes"
            rows="3"
            [(ngModel)]="model.notes"></textarea>
        </div>
      </div>

      <div class="d-flex justify-content-end mt-4 gap-2">
        <button
          type="button"
          class="btn btn-outline-secondary"
          (click)="onCancel()"
          [disabled]="loading">
          <i-lucide name="x" class="me-1"></i-lucide>
          Cancel
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="subscriptionForm.invalid || loading">
          <span *ngIf="loading" class="spinner-border spinner-border-sm me-1" role="status"></span>
          <i-lucide *ngIf="!loading" name="save" class="me-1"></i-lucide>
          {{ isEdit ? 'Update' : 'Save' }} Subscription
        </button>
      </div>
    </form>
  </div>
</div>
